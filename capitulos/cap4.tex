\chapter{Sistema desenvolvido} \label{cap:cap4}

O sistema desenvolvido a partir do uso do dispositivo háptico para treinamento de anestesia raquidiana apresentada nesta tese envolve a criação de um simulador que permite o treinamento de aprendizes na técnica de anestesia raquidiana utilizando um ambiente virtual de treinamento.
Este ambiente virtual foi desenvolvido utilizando o motor de jogo Unity3D \cite{UnityTechnologies2020} com uso de \textit{plugin} para o dispositivo háptico \textit{Geomagic Touch}®, os \textit{scripts} foram desenvolvidos em C\#. O código foi desenvolvido a partir do simulador epidural desenvolvido por \textcite{Brazil2017thesis} levando em consideração que diversas funcionalidades existentes foram estendidas e modificadas bem como outras foram criadas. O foco passou de anestesia epidural para anestesia raquidiana. Um novo modelo 3D foi construído para representar as camadas do corpo humano, para isto, as formas e volumes das camadas foram baseadas num corpo 3D interativo cientificamente preciso \cite{BioDigitalInc2019}. Adicionalmente, as principais camadas (tecidos do corpo) foram programadas com um margem de crescimento individual onde o crescimento da camada mais interna ``empurra'' as camadas mais externas pra fora. Isto foi feito para possibilitar uma maior diversidade de cenários e para que estes sejam visualmente coerentes quando a transparência das camadas for aplicada. Além da possibilidade de se crescer individualmente cada camada, também é possível que todas as camadas cresçam de forma homogênea através da aplicação de matrizes de transformação. 

\section {Desenvolvimento do ambiente de treinamento} 

O modelo 3D para o tronco do corpo feminino (área onde é feita a punção) foi desenvolvido usando o software de modelagem e criação \textit{3ds Max} \cite{Autodesk}. Exemplos das suas diversas camadas internas podem ser observados na figura \ref{fig:modelo3Dcorpo}. 

\begin{figure}[ht!]
    \centering
        \begin{tabular}{cc}
        \includegraphics[width=0.4\linewidth]{capitulos/figuras/modelo corpo 3d.PNG} & 
        \includegraphics[width=0.6\linewidth]{capitulos/figuras/modelo corpo 3d - coluna vertebral, ligamentos supra, interespinhoso and flavum.PNG} 
        \\
        (a) & (b)
        \end{tabular}
    \caption{Modelo 3D de corpo de mulher grávida desenvolvido com diferentes níveis de transparência \cite{Melo2021}: (a) Corpo, ossos e músculos (b) Osso, vértebras e ligamentos.}
    \label{fig:modelo3Dcorpo}
\end{figure}

Como comentado anteriormente foram criados controles para crescimento das principais camadas do corpo. Para seu uso, primeiro é necessário iniciar um projeto na \textit{Unity} e importar o modelo 3D. Com isto estes controles ficam acessíveis via código nas diversas linguagens suportadas pela \textit{Unity} assim como via interface da \textit{Unity}. Como precisávamos fazer modificações em tempo de execução optamos pelo acesso através do código em C\# para fazer as modificações de tamanho das camadas (quando necessário). 

Para que seja possível fazer a interação com o dispositivo háptico \textit{Geomagic Touch®} o driver \textit{Open Haptics Touch Device} precisa ser instalado na máquina onde o dispositivo será usado, este driver pode ser encontrado no endereço eletrônico da empresa responsável pela produção e comercialização deste dispositivo háptico \cite{3DSystemsTouch2018}. Para que este dispositivo possa ser utilizado na \textit{Unity} optamos pela instalação do \textit{Haptic Plug-In For Unity3D} \cite{Poyade2014}. Este \textit{plugin} contém exemplos que exploram as funcionalidades dos dispositivos hápticos suportados. As características específicas que foram utilizadas nos experimentos são comentadas no capítulo~\ref{cap:cap5}. No ambiente de treinamento utilizamos configurações similares as dos experimentos ajustadas de acordo com cada corpo de paciente em simulação. 

Foi incluída uma visão lateral (Figura~\ref{fig:posicaoSentadaComTransparencia}) para possibilitar um outro ponto de vista do procedimento (ideia oriunda do \textit{feedback} de um anestesista sobre pontos de melhoria da ferramenta de treinamento). Esta característica ajuda não só o indivíduo em treinamento mas também pessoas que estejam assistindo ao vivo ou ainda gravações deste que venham a ser disponibilizado futuramente. Nesta mesma imagem fizemos também a demonstração da visibilidade das camadas interiores do corpo (que é exibida ao pressionar com o mouse o botão ``visibilidade'' no menu do lado esquerdo) ou ao pressionar a tecla ``V'' do teclado. Esta funcionalidade pode ser utilizada por iniciantes nos seus primeiros treinamentos assim como por educadores para turmas que estejam assistindo demonstrações feita por estes. Pode-se ler ainda nessa imagem (no alto a direita) as instruções sobre como alternar entre equipamentos, essa alteração pode ser feita a partir de números do teclado ou do segundo botão do dispositivo háptico. Consideramos aqui como primeiro botão o botão que fica mais perto da ponta da ``caneta'' do dispositivo. Este primeiro botão ao ser pressionado faz com que o liquido da anestesia seja expelido da seringa. As setas para direita e esquerda variam a posição de visualização como se o médico estivesse se deslocando lateralmente na cena. Na parte da esquerda (ligeiramente acima da área do tronco da paciente) e acima dos botões estão os dados da paciente (idade, altura e peso). 

\begin{figure}[ht!]
    \centering
    \includegraphics[width=0.9\linewidth]{capitulos/figuras/sistema posicao sentada com transparencia.png} 
    \caption{Visão geral do sistema com tronco de paciente centralizada na tela na posição sentada. Do lado inferior direito a visão lateral desta mesma parte do corpo. Neste caso foi aplicada a transparência para visualização das camadas internas}
    \label{fig:posicaoSentadaComTransparencia}
\end{figure}

Uma outra opção de execução do procedimento incluída foi a possibilidade de mudança de posição da paciente (Figura~\ref{fig:posicaoDeitada}) que além da posição sentada (original e mais comum) agora também permite que o procedimento seja feito com ela deitada (estas são as duas posições em que ocorre o procedimento de raquianestesia \ref{sec:anestesiaRaquidiana}).

\begin{figure}[ht!]
    \centering
    \includegraphics[width=0.9\linewidth]{capitulos/figuras/sistema posicao deitada.png} 
    \caption{Visão geral do sistema com tronco de paciente na posição deitada.}
    \label{fig:posicaoDeitada}
\end{figure}

\subsection {Simulação de pacientes virtuais} 
\label{sec:SimulacaoPacientesVirtuais}

Um dos benefícios da criação de ambientes virtuais para treinamento é a possibilidade de se ter uma quantidade muito grande de casos com características diferentes para o treinamento. Estas possibilidades estão limitadas somente pela abrangência do modelo para criação de pacientes virtuais. Conforme descrito anteriormente para esta tese foi criado e utilizado um modelo dinâmico para geração de pacientes do sexo feminino grávidas. A variação física externamente visível das pacientes é função da altura e massa corpórea. Para as camadas internas envolvidas na anestesia raquidiana a distância da pele até o espaço epidural (\acrshort{DEE}) também entra nessa conta para uma representação mais real da relação entre os dados de massa e altura da paciente com a distância entre estas camadas conforme descrito na seção \ref{sec:modelagemTecidos}. 

Descrevemos aqui como fizemos o uso dos dados e equações de populações locais descritas por \textcite{Clinkscales2007, Sharma2011, Hazarika2016} para a modelagem de uma equação genérica na determinação da \acrshort{DEE} buscando representar todos os grupos populacionais da Tabela~\ref{tab:PopulacaoPorEstudo}.
A abordagem que detalharemos aqui foi descrita em trabalho publicado por nós \cite{Melo2020}.

\textcite{Sharma2011} ao invés das equações apresentaram cinco pontos contendo a \acrshort{DEE} o \acrshort{IMC} representando cada população, optamos então por utilizar o método dos mínimos quadrados para obter as equações de cada grupo através do melhor ajuste de curva que representasse cada um dos quatro grupos da Tabela~\ref{tab:DEEEstimadosSharma}. Para cada ponto consideramos o eixo X como \acrshort{IMC} e o eixo Y como a \acrshort{DEE}. As equações resultantes (que minimizam a soma do quadrado das diferenças para cada ponto) para cada grupo desta tabela estão representadas na Tabela~\ref{tab:DEEEquacoesMinimosQuadrados}. Os nomes dos grupos na tabela estão renomeados para como iremos nos referenciar a cada grupo no restante desta tese.

\begin{table}[!ht]
\begin{center}
\caption{Equações resultantes do uso do métodos dos mínimos quadrados nos dados de \textcite{Sharma2011}.}
\label{tab:DEEEquacoesMinimosQuadrados}
\begin{tabular}{|p{0.4\linewidth}|p{0.4\linewidth}|}
\hline
\textbf{Grupo} & \textbf{Equação}\\
\hline\hline
RU - Brancas & DEE = 2,18 + 0,13 IMC\\
RU - Asiáticas & DEE = 2,24 + 0,11 IMC\\
RU - Negras & DEE = 1,98 + 0,15 IMC\\
RU - Chinesas & DEE = 3,08 + 0,07 IMC\\
\hline
\end{tabular}
\end{center}
\end{table}

Os dados brutos dos indivíduos de cada população dos três trabalhos analisados na seção \ref{sec:modelagemTecidos} não foram disponibilizados publicamente. Desta forma, foi tomado como premissa que o resultado de cada equação representa corretamente a \acrshort{DEE} dos indivíduos da população para o qual cada trabalho foi desenvolvido. Com isto geramos randomicamente dados de massa, altura e idade para duzentas pacientes. Os valores mínimos e máximos para cada parâmetro foram: Massa (em quilos) de 50 a 70; Altura (em metros) de 1,40 a 1,90; Idade de 18 a 40 anos. Os valores de massa e altura foram utilizados para que fossem contemplados indivíduos com baixo peso, peso médio, sobrepeso e obesidade com base na \textit{Pregnancy Weight Gain Calculator} (Calculadora de ganho de peso na gravidez) \cite{MTILLC2019}. Pra idade mínima levamos em conta a definição de maioridade civil e para a idade máxima foi considerado o aumento do risco de gravidez acima da idade de quarenta anos. A quarta variável de entrada, \acrshort{IMC}, foi calculada pela equação padrão (que usa massa em quilos dividido pelo quadrado da altura em metros).  A Tabela~\ref{tab:DadosPopulacaoGerada} descreve a média e o desvio padrão das três características das pacientes que foram geradas randomicamente para criar os dados populacionais assim como o \acrshort{IMC} calculado a partir destas três variáveis. 

\begin{table}[!ht]
\begin{center}
\caption{Dados populacionais gerados aleatoriamente.}
\label{tab:DadosPopulacaoGerada}
\begin{tabular}{|p{0.3\linewidth}|p{0.2\linewidth}|p{0.3\linewidth}|}
\hline
\textbf{Característica} & \textbf{Média} & \textbf{Desvio Padrão}\\
\hline\hline
Idade (anos) & 28,70 & 6,58\\
Altura (m) & 1,65 & 0,15\\
Massa (kg) & 68,97 & 11,80\\
IMC ($kg/m^2$) & 25.84 & 6,55\\
\hline
\end{tabular}
\end{center}
\end{table}

Usando os dados populacionais como entrada calculamos o \acrshort{DEE} das duzentas pacientes para cada grupo populacional usando as equações das Tabelas \ref{tab:equacoesEstimativaDEE} e~\ref{tab:DEEEquacoesMinimosQuadrados}. A Figura~\ref{fig:mediaDesvioPadraoPopulacoes} ilustra as médias e desvios padrões da \acrshort{DEE} dos grupos populacionais sinteticamente gerados a partir das equações destas tabelas. No gráfico desta figura cada grupo é identificado pelo local de onde  foram feitos os estudos que geraram as equações ou os dados que embasaram as equações para produção das amostras sintéticas assim como pelos grupos nos quais cada estudo separou seus dados.

\begin{figure}[ht!]
    \centering
    \includegraphics[width=0.8\linewidth]{capitulos/figuras/Media e desvio padrao dos grupos.png} 
    \caption{Média e desvio padrão da \acrshort{DEE} estimada para as populações de cada grupo de grávidas separadas pelo local dos estudos e grupos distintos.}
    \label{fig:mediaDesvioPadraoPopulacoes}
\end{figure}

Para determinação de uma equação geral foram considerados os dados de todos os indivíduos em um grande conjunto. Desconsideramos os grupos populacionais e utilizamos os dados de todos os seis grupos como entrada de um método de regressão multilinear. A amostra populacional randômica é de n=200 (número de indivíduos em cada grupo), considerando os 6 grupos tem-se então uma população para esta abordagem de n=1200. A influência de todas as variáveis  independentes (massa, altura, idade e \acrshort{IMC}) foi testada em relação à \acrshort{DEE} no modelo de regressão multilinear. Somente o \acrshort{IMC} demonstrou ter significância estatística (p<0,01). A equação de regressão \ref{equ:equacaoGenerica} representa este modelo. 

\begin{equation}
\label{equ:equacaoGenerica}
Y=2,52+0,11 IMC
\end{equation}

Levando em consideração os dados de todos os grupos, o valor médio da \acrshort{DEE} é de 5,3 cm com um desvio padrão de 0,74 cm. Os valores mínimos e máximos são respectivamente 3,82 cm e 8,6 cm. A Figura~\ref{fig:imcDEEPopulacoesComparativoEquacaoGenerica} mostra graficamente a comparação dos resultados das estimativas da  \acrshort{DEE} para as equações de todos os grupos em relação à equação genérica (curva laranja). O grupo de nome ``RU - Negras'' apresenta os maiores valores de \acrshort{DEE} e o grupo Índia e ``RU - Chinesas'' apresentam os valores mais baixos. Os resultados da equação genérica apresentam como resposta um valor médio de todos os grupos.

\begin{figure}[ht!]
    \centering
    \includegraphics[width=0.9\linewidth]{capitulos/figuras/IMC versus DEE grupos populacionais e Equacao Generica.png} 
    \caption{\acrshort{IMC} x \acrshort{DEE} para os grupos populacionais em comparação a equação genérica.}
    \label{fig:imcDEEPopulacoesComparativoEquacaoGenerica}
\end{figure}

O valor 69,19\% do R-quadrado ajustado se refere a equação \ref{equ:equacaoGenerica}. Este valor indica a proximidade entre os valores observados e estimados da variável analisada (neste caso a \acrshort{DEE}). É um indicativo de quanto o modelo de regressão se aproximou dos dados de entrada. Embora o foco dessa tese seja na representação da realidade brasileira é importante ressaltar que não encontramos nas nossas pesquisas dados deste tipo para a população brasileira que é conhecidamente uma população miscigenada.  Com uma aproximação de quase 70\% e representando uma média das diferentes populações usadas como entrada para este cálculo assumimos que a equação genérica pode ser satisfatória para fins de determinação da \acrshort{DEE} de brasileiras por ter sido estimada a partir de uma população diversa e abrangente. Assumimos então que esta será utilizada nesta tese por não existirem equações mais representativas da determinação deste valor para grávidas brasileiras que é o foco aqui.

Para a determinação do tamanho de cada camada utilizamos então o valor da \acrshort{DEE} calculada por essa equação genérica fazendo com que o crescimento seja proporcional em cada camada. Dessa forma esse crescimento mantém a ordem de grandeza dos tamanhos das camadas e leva em conta a informação de que o tecido mais afetado com a variação do \acrshort{IMC} do paciente provavelmente deve se relacionar a gordura subcutânea \cite{Palmer1983}.

A seguir iremos ilustrar como considerar a possibilidade de variação ou criação de novos corpos de pacientes através dos parâmetros existentes no modelo 3D desenvolvido. Essas alterações do corpo podem ser feitas tanto via interface da \textit{Unity} (de forma estática) como via código C\# (de forma dinâmica). 

Como primeiro exemplo apresentamos as alterações de crescimento do tronco simulando uma paciente com um \acrshort{IMC} mais elevado em comparação com uma paciente com um corpo de \acrshort{IMC} mais baixo. As duas imagens apresentadas na Figura~\ref{fig:extremosCorpoIMC} ilustram os extremos que podem ser obtidos com a variação de parâmetros implementada no modelo 3D criado. Para variações maiores podemos usar transformações matriciais através de simples comandos na \textit{Unity} usando a transformação de escala aplicados. Optamos pela implementação de um range de variação para evitar a deformação através de matrizes de transformação aplicadas no objeto 3D como um todo. É sabido que existem regiões que são as mais afetadas pelo ganho de gordura corporal e, portanto, devem ser mais expandidas do que outras, visando um ganho visual mais próximo do real. Na Figura~\ref{fig:extremosCorpoIMC} apresentamos o \textit{wireframe} de forma a ilustrar os polígonos que fazem parte do modelo 3D do corpo. Para fazer essas alterações via interface da \textit{Unity} primeiro é necessário importar o modelo 3D no projeto. Em seguida é necessário adicionar este a hierarquia e posicioná-lo corretamente na cena. Ao selecionar o elemento do modelo 3D (que se chama \textit{Body}) é preciso alterar o componente \textit{Skinned Mesh Renderer} associado pelo \textit{Unity} no momento da importação para cada camada (parte do modelo 3D) que possui parametrização (os componentes ficam na janela \textit{Inspector}). Este componente possui uma seção chamada \textit{BlendShapes} que exibe os parâmetros de deformação da forma. O parâmetro do objeto \textit{Body} se chama \textit{Body\_Final\_Channel} e aceita valores de zero a cem, sendo 0 (zero) o valor que indica a ausência de deformação (Figura~\ref{fig:extremosCorpoIMC} (a)) e 100 (cem) o valor de maior deformação (Figura~\ref{fig:extremosCorpoIMC} (b)). Para alteração via código na mudança de pacientes utilizamos o script em C\#. O acesso para modificação deste percentual de deformação é feito a partir da variável que representa o corpo, para este caso a camada \textit{Body} fica posicionada num vetor de camadas na primeira posição. A Listagem~\ref{lst:codigo_alteracao_forma_paciente} apresenta um exemplo da parte do código que faz a deformação do corpo do paciente a partir do parâmetro passado. Este parâmetro é calculado como valor percentual a partir dos valores de \acrshort{DEE} mínima e máxima implementados no sistema e do \acrshort{IMC} do paciente que é calculado a partir do seu peso e altura. Utilizamos a equação \ref{equ:equacaoGenerica} para cálculo da \acrshort{DEE} de cada paciente e, portanto, para determinação dos seus mínimos e máximos. Os valores mínimos e máximos da \acrshort{DEE} são fixos pra cada execução do sistema sendo calculados a partir da base de pacientes disponível. Esta base pode ser alterada livremente para aumentar ou diminuir a variabilidade de cenários de teste conforme necessidade.

\begin{lstlisting}[label=lst:codigo_alteracao_forma_paciente, caption={Exemplo de alteração do corpo do paciente via script em C\#.}, language=sharpc]
float imc = objPaciente.peso / (objPaciente.altura * objPaciente.altura);
float dee = 2.52 + 0.11 * imc
float percentDeformacaoCorpo = 100 * (dee - minDEE) / (maxDEE - minDEE);
        
SkinnedMeshRenderer smRenderer;
smRenderer = camadas[0].GetComponent<SkinnedMeshRenderer>();
smRenderer.SetBlendShapeWeight(0, percentDeformacaoCorpo);
\end{lstlisting}

\begin{figure}[ht!]
    \centering
        \begin{tabular}{cc}
        \includegraphics[width=0.4\linewidth]{capitulos/figuras/Corpo-menor-IMC-Wireframe.png} & 
        \includegraphics[width=0.38\linewidth]{capitulos/figuras/Corpo-maior-IMC-Wireframe.png} 
        \\
        (a) & (b)
        \end{tabular}
    \caption{Troncos com extremos de \acrshort{IMC} via parâmetro na posição lateral com \textit{wireframe}: (a) Menor \acrshort{IMC} (b) Maior \acrshort{IMC}.}
    \label{fig:extremosCorpoIMC}
\end{figure}

Na Figura~\ref{fig:pacientesMaiorParaMenorIMCVisaoTroncoELateral} exibimos todas as pacientes atualmente cadastradas no sistema ordenadas de forma decrescente em relação ao \acrshort{IMC}. Ao lado de cada tronco com os dados de idade, altura e peso inserimos também a visão lateral para melhor visualização das diferenças (que são distribuídas nos eixos X e Z). Fazendo um comparativo desde a paciente com maior \acrshort{IMC} (no alto a esquerda) até a de menor (abaixo a direita) é possível observar parte das variações implementadas no modelo 3D em relação a camada do corpo. Observando a área da cintura, barriga e dorso pode-se perceber o afinamento destas áreas conforme o \acrshort{IMC} é reduzido. É importante ressaltarmos aqui que a possibilidade de ajustar altura (crescimento no eixo Y) não foi trabalhada no modelo 3D por motivos de simplificação mas esta pode ser alterada a partir de transformações de matrizes via \textit{Unity}. O eixo mais importante para o contexto da simulação de raquianestesia é o da profundidade das camadas a serem transpassadas (eixo Z), por que é neste eixo que a agulha é inserida.

\begin{figure}[ht!]
    \centering
    \includegraphics[width=0.9\linewidth]{capitulos/figuras/pacientes cadastradas maior para menor imc visao tronco sentado e lateral.png} 
    \caption{Ilustração dos troncos das pacientes cadastradas renderizados no sistema juntamente com a visão lateral do maior para o menor IMC.}
    \label{fig:pacientesMaiorParaMenorIMCVisaoTroncoELateral}
\end{figure}

Para configuração do \textit{Haptic Plug-In For Unity3D} \cite{Poyade2014} que é o plugin que utilizamos para tratar da interface entre dispositivo háptico com os itens 3D da simulação precisamos adicionar a cada camada do corpo alguns componentes. Os componentes a serem adicionados às camadas são o \textit{Haptic Properties} e o \textit{Mesh Collider} através da seleção da camada na hierarquia e, em seguida, no \textit{Inspector} deve-se ir no item Adicionar componentes e entrar com o nome destes. O componente \textit{Haptic Properties} vem junto com o \textit{Haptic Plug-In For Unity3D}. Ele serve para configurar as propriedades de interação com o háptico aos itens do universo 3D como as camadas do corpo da paciente no nosso caso (pele e demais camadas internas). Um exemplo de propriedade é a \textit{Pop Through} que indica o quanto de força é necessário aplicar para que se perfure cada camada que está em contato com a agulha de anestesia durante uma simulação. Temos então configurações distintas para quando o movimento do háptico está representando o movimento do dedo do anestesista para apalpação e descobrimento do local correto de punção e para o momento que o movimento representa os objetos perfurantes como a seringa de anestesia local e a agulha de raquianestesia. No caso do anestesista estar fazendo a apalpação esta propriedade deve assumir um valor que desabilita a perfuração (o valor para este caso é zero). Demais características a respeito das propriedade utilizadas são descritas no capítulo~\ref{cap:cap5}. Já o componente \textit{Mesh Collider} é nativo do \textit{Unity} e é uma das formas de detecção de colisão da \textit{engine} que usa a geometria visível do objeto para tal. Outra configuração necessária para todos os objetos que tem interação com o háptico é a inclusão  da tag \textit{Touchable} que deve ser feita através do \textit{Inspector}. Esta também deve ser incluída em todos os objetos 3D que podem sofrer alguma influência a partir da movimentação do dispositivo háptico.

% === FALAR sobre associações de scripts Haptic Injection, Generic Functions Class?

\section {Etapas da simulação}

O simulador ao ser iniciado apresenta uma paciente dentre as seis pré-configuradas ilustradas na Figura~\ref{fig:pacientesMaiorParaMenorIMCVisaoTroncoELateral}. Nestas existem pacientes com peso considerado normal, excesso de peso e obesas \cite{MTILLC2019}. O usuário deve então usar o dispositivo háptico para interagir com o ambiente virtual. Ao ser iniciado o sistema e a cada inicio de procedimento em uma nova paciente ao movimentar o dispositivo háptico o item que representa o dedo é movimentado no ambiente virtual de treinamento. O item no ambiente 3D que representa o dedo pode ser observado na Figura~\ref{fig:elementosDeInteracao} (a) do lado direito do tronco da paciente. Outro item a ser observado nesta imagem é uma esfera azul que indica onde foi o último toque do dedo no corpo da paciente. O último ponto tocado foi a estratégia definida para determinação da escolha do ponto de inserção da agulha na simulação. Nas Figuras~\ref{fig:elementosDeInteracao} (b) e (c) estão atrás do tronco da paciente respectivamente a seringa para anestesia local e a agulha usada para aplicação da raquianestesia. No momento da aplicação da raquianestesia uma seringa é conectada no final da agulha como pode ser visto pela visão lateral na Figura~\ref{fig:agulhaRaquiSeringa}.

\begin{figure}[ht!]
    \centering
        \begin{tabular}{ccc}
        \includegraphics[width=0.3\linewidth]{capitulos/figuras/corpo-paciente-apos-apalpacao-dedo.png} & 
        \includegraphics[width=0.27\linewidth]{capitulos/figuras/corpo-paciente-seringa.png} & 
        \includegraphics[width=0.27\linewidth]{capitulos/figuras/corpo-paciente-agulha-raqui.png} 
        \\
        (a) & (b) & (c)
        \end{tabular}
    \caption{Elementos 3D de interação com o ambiente representativos do: (a) Dedo (b) Seringa para anestesia local (c) Agulha de raquianestesia.}
    \label{fig:elementosDeInteracao}
\end{figure}

\begin{figure}[ht!]
    \centering
    \includegraphics[width=0.4\linewidth]{capitulos/figuras/corpo-visao-lateral-agulhaRaquiSeringa.png} 
    \caption{Visão lateral do corpo da paciente com aproximação da agulha de raquianestesia com a seringa conectada.}
    \label{fig:agulhaRaquiSeringa}
\end{figure}

Cada procedimento no simulador é considerado como sendo finalizado no momento que é aplicada a raquianestesia, ou seja, ao ser pressionado o embolo da seringa conectada na agulha desde que esta esteja dentro do corpo do paciente.
É necessário completar a execução de ao menos três procedimentos tendo a média acima de seis para que a habilidade do usuário seja considerada como satisfatória. A nota final corresponde a média da nota obtida em todos os procedimentos executados. No casos de não se atingir a média seis nos três primeiros procedimentos será necessário executar tantos procedimentos quanto forem necessários para se chegar a média seis considerando todos os procedimentos executados.   

A Tabela~\ref{tab:PontosNotaProcedimento} ilustra a pontuação para formação da nota de cada procedimento. Para cada procedimento a nota inicia em zero. Itens feitos corretamente e na sequência correta tem pontuação positiva e itens feitos de forma incorreta ou não feitos tem pontuação negativa. Para algumas ações não feitas ao invés da pontuação negativa não é aplicada nenhuma penalização uma vez que a não execução correta já acarreta em penalização por não adicionar pontuação positiva na nota. O item que tem mais influência na pontuação é a aplicação na raqui no local correto uma vez que está é que determina se a pessoa estará ou não corretamente anestesiada ao final do procedimento.

\begin{table}[!ht]
\begin{center}
\caption{Pontos para formarem a nota final de cada procedimento.}
\label{tab:PontosNotaProcedimento}
\begin{tabular}{|p{0.9\linewidth}|p{0.1\linewidth}|}
\hline
\textbf{Item executado} & \textbf{Ponto}\\
\hline\hline
Execução da apalpação para determinação do local de inserção da agulha & +1\\
%Perfuração do corpo com seringa ou agulha antes da apalpação & -1\\
Anestesia local não aplicada & -1\\
Anestesia local aplicada com a seringa no local correto & +3\\
Avanço com a seringa até camadas indevidas (ex. ossos, espaço epidural) & -1\\
Perfuração do corpo da paciente duas ou três vezes (com seringa ou agulha) & -1\\
Perfuração do corpo da paciente quatro vezes ou mais (com seringa ou agulha) & -2\\
Inseriu a agulha de raquianestesia sem antes aplicar a anestesia local & -1\\
Aplicação da raquianestesia em local diferente do espaço subaracnóide & -3\\
Aplicação da raquianestesia no espaço subaracnóide & +6\\
\hline
\end{tabular}
\end{center}
\end{table}

São apresentados \textit{feedbacks} para o usuário durante e ao final dos procedimentos executados em cada uma das pacientes. As Figuras \ref{fig:sistemaExecucao1RaquiLocalIncorreto}, \ref{fig:sistemaExecucao2seringaCorreto}, \ref{fig:sistemaExecucao3faltouApalpacaoAnestesiaLocalIncorreto}, \ref{fig:sistemaExecucao4correto} e \ref{fig:sistemaExecucao5semApalpacaoCorreto} mostram uma sequência de possíveis execuções de anestesias ilustrando diferentes erros e acertos durante cada procedimento que são visualizados no \textit{feedback} a direita durante a execução dos procedimentos e na janela de \textit{popup} ao final destes. As Figuras \ref{fig:sistemaExecucao1RaquiLocalIncorreto} e \ref{fig:sistemaExecucao3faltouApalpacaoAnestesiaLocalIncorreto} ilustram execuções de procedimentos onde as execuções foram abaixo da média (nota menores que seis) e portanto consideradas de desempenho não satisfatório. Na Figura \ref{fig:sistemaExecucao1RaquiLocalIncorreto}  nota de um foi obtida pois o usuário fez corretamente a apalpação para determinação do ponto de inserção da agulha e fez uma correta aplicação da anestesia local porém aplicou a raquianestesia no local indevido. Já na Figura \ref{fig:sistemaExecucao3faltouApalpacaoAnestesiaLocalIncorreto} o erro foi ter esquecido de fazer tanto a apalpação pra escolha do ponto de inserção da agulha quanto a aplicação da anestesia local mas aplicou corretamente a raquianestesia o que fez ele receber cinco como nota final do procedimento. Os demais três procedimentos foram efetuados com resultados acima da média sendo um deles (Figura \ref{fig:sistemaExecucao4correto}) com a nota máxima (dez) por não ter cometido nenhum erro ou esquecimento. No procedimento representado pela Figura \ref{fig:sistemaExecucao5semApalpacaoCorreto} a nota final foi nove pois o único erro foi o de esquecimento da apalpação para determinação do ponto de inserção da agulha. Na Figura \ref{fig:sistemaExecucao2seringaCorreto} os erros de execução no procedimento foram a perfuração do corpo da paciente mais de três vezes com a seringa e avanço desta para camadas indevidas o que fez com que a nota final para este caso fosse sete. 
Após os cinco procedimentos efetuados, uma vez que três deles tiveram notas acima da média e a média da nota de todos os cinco procedimentos foi maior que seis (somatório das cinco notas foi de 32) o usuário foi parabenizado pela sua performance e não foi necessário continuar com os treinamentos. Esta sequência de telas ilustra um treinamento usando o simulador desde o seu início até o final. Um video que ilustra toda a execução de um procedimento assim como uma visão geral do ambiente de treinamento desenvolvido nesta tese pode ser visto no link\footnote{\url{https://youtu.be/g9RZRYId9ys}}. Para demonstrar as funcionalidades dos botões laterais incluindo a transparência das camadas e em parte o \textit{feedback} dado durante o procedimento foi gravado um outro video que pode ser visto no link\footnote{\url{https://youtu.be/gGpJKjkVYWU}}.

\begin{figure}[ht!]
    \centering
    \includegraphics[width=\textwidth]{capitulos/figuras/sistema-exemplo-execucao-procedimento-1.png} 
    \caption{Tela do sistema após finalização de um primeiro procedimento onde a raquianestesia foi aplicada em local incorreto.}
    \label{fig:sistemaExecucao1RaquiLocalIncorreto}
\end{figure}

\begin{figure}[ht!]
    \centering
    \includegraphics[width=\textwidth]{capitulos/figuras/sistema-exemplo-execucao-procedimento-2.png} 
    \caption{Tela do sistema após finalização de um segundo procedimento onde a seringa foi inserida mais de três vezes no corpo da paciente e esta tocou partes indevidas.}
    \label{fig:sistemaExecucao2seringaCorreto}
\end{figure}

\begin{figure}[ht!]
    \centering
    \includegraphics[width=\textwidth]{capitulos/figuras/sistema-exemplo-execucao-procedimento-3.png} 
    \caption{Tela do sistema após finalização de um terceiro procedimento onde o usuário não fez a apalpação para escolher o ponto de inserção da agulha e nem aplicou a anestesia local antes de inserção da agulha de raquianestesia.}
    \label{fig:sistemaExecucao3faltouApalpacaoAnestesiaLocalIncorreto}
\end{figure}

\begin{figure}[ht!]
    \centering
    \includegraphics[width=\textwidth]{capitulos/figuras/sistema-exemplo-execucao-procedimento-4.png} 
    \caption{Tela do sistema após finalização de um quarto procedimento onde todo o procedimento foi executado de forma correta.}
    \label{fig:sistemaExecucao4correto}
\end{figure}

\begin{figure}[ht!]
    \centering
    \includegraphics[width=\textwidth]{capitulos/figuras/sistema-exemplo-execucao-procedimento-5.png} 
    \caption{Tela do sistema após finalização de um quinto procedimento onde só não foi feita a apalpação para determinação do ponto de inserção da agulha.}
    \label{fig:sistemaExecucao5semApalpacaoCorreto}
\end{figure}